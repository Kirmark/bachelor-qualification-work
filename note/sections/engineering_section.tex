\chapter{Конструкторский раздел}
\todo[inline]{25 – 30 страниц}
\todo[inline]{написать что такое коллекции}
%


Для проектирования программной реализации необходимо разбить весь процесс на этапы. При разбиении следует руководствоваться теми или иными, уже существующими, решениями для хранения и обработки информации.

В сети Интернет документы хранятся в виде html-файлов.
Для обучения модели необходимо получить данные в виде мешков слов.
Кроме того, из-за большого объема данных необходимо разделить предварительную обработку каждого документа и последующий сбор обработанных данных в общую коллекцию для обучения.

Отдельным пунктом была рассмотрена структура анализируемых данных, чтобы при выборе средств реализации можно было использовать эту информацию. 

Процесс создания тематической модели разбивается на следующие этапы:

\begin{itemize}
    \item сбор данных;
    \item обработка данных;
    \item обучение модели;
    \item использование модели;
    \item оценка модели.
\end{itemize}


%
\section{Структура анализируемых данных}

\todo[inline] {добавить высокоуровневый тип данных, ограничения}

Очевидно, что для работы решения необходимо хранить коллекцию новостей, где о каждом документе известны тема новости, текст новости, ссылка на html-файл новости в сети Интернет.

Так как данные обрабатываются подокументно, будет удобно иметь данные в обработанном виде рядом с сырыми, чтобы иметь возможность обрабатывать коллекцию по частям.

При описании структуры данных желательно предоставить возможность обновлять данные, так как со временем html документы на выбранном ресурсе могут меняться. Для этого необходимо хранить дату сохранения документов.

Кроме того, процесс обработки данных также может быть усовершенствован или изменен. Следовательно, также необходимо хранить дату обработки данных.

Так как все данные текстовые и однородные, для хранения выбрана таблица в базе данных со следующими полями: 

\begin{itemize}
    \item тема новости;
    \item текст новости; 
    \item ссылка на html файл новости в сети Интернет;
    \item обработанный текст новости;
    \item дата сохранения документа;
    \item дата обработки данных.
\end{itemize}

~\

Для организации сохранения всех новостей с выбранного ресурса необходимо отслеживать на какие страницы ресурса ведут уже обработанные страницы. Для этого создается еще одна таблица с данными: какая ссылка, на какую другую ссылку ведет. То есть создается таблица со следующими полями: 

\begin{itemize}
    \item ссылка-родитель;
    \item ссылка-ребенок.
\end{itemize}

%
\section{Сбор данных}
\todo[inline]{как будем извлекать данные (без кода пока)} 


В аналитическом разделе были выделены несколько типов данных: 

\begin{itemize}
    \item предварительно подготовленные массивы новостей; 
    \item новостные сайты;
    \item новостные агрегаторы.
\end{itemize}

~\

Рассмотрим их детальнее. 

%
\subsubsection{Предварительно подготовленные массивы новостей}

Обычно в таких массивах данных текст новостей и их заголовки уже очищены от форматирования и переносов, опечатки исправлены, а также удалена нетекстовая информация. При этом остаются следующие проблемы:

\begin{itemize}
    \item слишком короткие тексты;
    \item слова в новостях не приведены к нормальной форме;
    \item не выделены словосочетания;
    \item много часто используемых слов и редко используемых слов;
    \item каждый такой массив данных оформлен по-своему, поэтому для работы с ним необходимо писать код, преобразующий коллекцию в удобный для модели формат.
\end{itemize}
 

Так как часть обработки уже выполнена, получить такой массив данных предпочтительнее, чем добывать данные из сети Интернет. Но стоит учесть, что найти такие массивы данных достаточно сложно. Необходимо опрашивать специалистов в этой области, изучать платформы сообществ по обработке естественного языка, анализировать архивы конференций.

%
\subsubsection{Новостные сайты и агрегаторы}

У данных, хранящихся в сети Интернет, существует большое количество недостатков: они не обработаны, текст хранится вперемешку с html кодом, содержит опечатки. Также из-за неорганизованности владельцев новостных сайтов, зачастую важные для последующего анализа данные (например, дата публикации, имя документа и т.д.) хранятся в разном виде за разные периоды времени, и поэтому их сложно извлечь. 

С другой стороны, такой подход предоставляет практически безграничные возможности выбора тематики для последующего анализа.

Для извлечения таких данных необходим специальный софт, который анализирует указанный интернет ресурс, а также все ссылки, на которые ведут уже скачанные страницы. Отдельно стоит отметить,и что часть ссылок зачастую на новостных сайтах появляются динамически, после того, как посетитель сайта нажимает специальную кнопку или перематывает страницу до конца.

Также учитывая технические ограничения автора работы и то, что документов на выбранном ресурсе может быть много, необходимо, чтобы процесс анализа и сохранения новостей можно было остановить в любой момент и впоследствии продолжить с места остановки.

Так как данная задача довольно распространена существует библиотеки, частично или полностью решающие проблему получения данных. Однако, часто данные на сайтах хранятся в таком виде, что приходится модифицировать существующие решения. 

%
\section{Обработка данных}
\todo[inline]{рассказать, что такое лемматизация}
\todo[inline]{Предобработка текста: лемматизация, удаление стоп-слов, ngrams}
\todo[inline]{Используем модальности (дата публикации, ссылки на другие документы, авторы)}

После того, как получены сырые данные, перед началом обучения модели, данные необходимо подготовить. Подготовка данных разбивается на два этапа:

\begin{itemize}
    \item обработка документа (новости);
    \item формирование коллекции в формате, удобном для модели.
\end{itemize}

%
\subsubsection{Обработка документа (новости)}

В рамках этого этапа подготовки данных производится обработка по документам. В связи с техническими ограничениями необходим хранить дату обработки, чтобы иметь возможность при изменении алгоритма выполнить процесс подготовки текста повторно. Кроме того, так же, как и в случае с сохранением страницы сети Интернет, из-за того, что данных много, необходимо реализовать возможность подготовки новостей коллекции по частям, останавливая и запуская процесс в любой момент времени.

Подготовку данных по документам можно разбить на следующие этапы.

\begin{itemize}
    \item\textbf{Очистка от форматирования и переносов.} В сыром виде текст новости часто перемешан с html кодом, специальными символами pdf файлов, часть слов разделены дефисов для переноса на новую строку.
    \item\textbf{Исправление опечаток.} Журналисты и редакторы могут не уследить за орфографической ошибкой, и обучаемая модель воспримет слово с ошибкой как отдельное редкое слово в коллекции.
    \item\textbf{Удаление нетекстовой информации:} рисунков, графиков, таблиц.
    \item\textbf{Приведение слов к нормальной форме.} Для английского языка используется \textbf{стемминг} (выделение неизменной части слова). Для данной работы лучше подходит \textbf{лемматизация}, так как новости на русском языке.
    \item\textbf{Выделение словосочетаний.} По умолчанию модель воспринимает каждое слово в тексте новости как отдельный термин. При выделении словосочетаний появляется возможность, обучая модель, относиться к ним как к цельным многословным терминам.
    \item\textbf{Удаление часто используемых слов.} Часто используемые слова встречаются в большом количестве тем, и их наличие в документе не может стать признаком того, какие именно темы затрагиваются в новости. 
    \item\textbf{Удаление редко используемых слов.} Редко используемые слова (обычно встречающиеся меньше десяти раз за коллекцию) также не несут обычно никакой информации о принадлежности документа к той или иной теме.
\end{itemize}

%
\subsubsection{Формирование коллекции в формате, удобном для модели}
\todo[inline]{Если будут использоваться модальности - дописать сюда про них}

После того, как каждый документ обработан и представлен в виде мешка слов необходимо собрать все документы в одну коллекцию. В связи с техническими ограничениями потребуется возможность собирать такую коллекцию по частям на основании источника документа, даты скачивания, даты обработки. В зависимости от выбранной реализации модели так же следует привести данные в формат, необходимый для обучения модели. Конкретное представление данных выбрано в технологическом разделе. Формирование коллекции должно выполняться отдельно от обработки подокументно так как происходит непосредственно перед обучением модели и может зависеть от целей исследователя.

%
\section{Обучение модели}
\todo[inline]{разработка метода}
\todo[inline]{Базовый алгоритм: ARTM (bigartm.readthedocs.io)}
\todo[inline]{Используем модальности (дата публикации, ссылки на другие документы, авторы)}
\todo[inline]{? Используем производные от статьи данные по различным алгоритмам (записываем в модальности) - алгоритмы еще не выбраны}
\todo[inline]{IDEF0 метода}

%
\section{Использование модели}
\todo[inline]{Можно попробовать обучаться на месяце/неделе/дне (и это в теории можно вынести в экперимент) и выдавать как меняются темы}
\todo[inline]{решить иерархически ли хотим строить темы или многое ко многим}
\todo[inline]{Дообучение}
\todo[inline]{Оценка документа}

%
\section{Оценка модели}
\todo[inline]{как будем оценивать (без кода)}
\todo[inline]{Перплексия - написать что плохая метрика}
\todo[inline]{Разбиение на 2 части и замеры разницы оценки - устойчивость - Через предложение разбивать статью можно попробовать}
\todo[inline]{Толока - описание теста - выбрать лишнее слово, подумать что еще можно}

%
\section{Требования к реализации}

На основании проведенного анализа в конструкторской части были сформированы следующие требования к реализации:

\begin{itemize}
    \item необходимо использовать реляционную базу данных для хранения документов,
    \item необходимые сущности и поля в базе данных:
    \begin{itemize}
        \item сущность страницы:
        \begin{itemize}
            \item тема новости,
            \item текст новости,
            \item ссылка на html-файл новости в сети Интернет,
            \item обработанный текст новости,
            \item дата сохранения документа,
            \item дата обработки данных;
        \end{itemize}
        \item сущность ссылки:
        \begin{itemize}
            \item ссылка родитель,
            \item ссылка ребенок;
        \end{itemize}
    \end{itemize}
    \item программный комплекс должен состоять из следующих отдельных процедур:
    \begin{itemize}
        \item сбор информации
        \item обработка информации подокументно
        \item формирование коллекции для обучения
        \item обучение модели
        \item использование модели
        \item вывод параметров модели для оценки
    \end{itemize}
    %\item при сборе данных необходимо указывать дату сохранения html-файла
\end{itemize}